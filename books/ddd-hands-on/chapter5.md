---
title: 'イベントストーミングを利用してドメインモデリングする'
---

# イベントストーミングとは

イベントストーミングは、**複雑なビジネスプロセスやドメインの知識を共有、可視化、そして理解するための協同作業ベースのモデリング手法**で、アルベルト・ブランディリーニ (Alberto Brandolini) 氏によって考案されました。
伝統的なモデリングや要件定義の手法は、多くの場合、ビジネスステークホルダーとソフトウェア開発者の間にコミュニケーションのギャップが生じる可能性がありました。イベントストーミングは、このギャップを埋めるために生み出されました。この手法は、関係者が同じ空間に集まり、ホワイトボードや miro などのオンラインコラボレーションツールを用いて、直感的でインタラクティブな方法でドメインの知識を共有し、問題点や機会を特定することを目的としています。

## 最終的にイベントストーミングを通じて作成された図

最終的な成果物はこちらです。それではどのような過程で作成されるか見ていきましょう。
@[figma](https://www.figma.com/file/g04nAogGCGgM62IKXHUSLT/Online-bookstore?type=whiteboard&node-id=843-1791&t=hvtQJVFBGW90SwuN-0)

## ルール

イベントストーミングにはいくつかの要素とルールが存在します。
まずは登場する要素を 7 つ紹介します。

1. **ドメインイベント**
   これは「何が起こったか」という出来事を表します。イベントは過去に起きるものなので過去形の動詞で表現されます（例：「注文が承認された」、「商品が出荷された」など）。ドメインイベントはビジネス上の重要な出来事や変更を示すもので、ドメインの中心的な要素として捉えられます。
2. **ポリシー**
   ドメインイベントが発生したときに何をすべきかを定義するビジネスルールやロジックを表します。ポリシーはあるドメインイベントに応じて実行すべきコマンドを決定するためのガイドラインとなります。
3. **コマンド**
   システムに何かを「行うように」という指示や命令を表す。その結果としてドメインイベントが発生します（例：「注文を承認する」、「商品を出荷する」など）。
4. **アクター**
   コマンドを発行する人やシステムのこと。アクターは外部の利用者やシステムであり、特定のコマンドを通じてドメインと対話します。
5. **ビュー/リードモデル**
   システムの状態や情報を参照するための表現です。これは通常、ユーザーインターフェイスで提供されるデータの表現を指します。
6. **集約(Aggregates)**
   集約とは、ドメイン駆動設計（DDD）における戦術的設計で、関連するデータとそのデータを操作するビジネスルールや制約を一つのグループにまとめたものです。これにより、データの不整合を防ぐための「一貫性の境界」が設けられ、この境界内でのみデータの状態変更が可能です。集約は複数の値オブジェクトやエンティティをまとめ、それらが共に働くことでビジネスの要件を満たすよう設計された、データとロジックのカプセル化された集合体です。
   :::message
   集約、値オブジェクトの詳細、実装はドメインオブジェクト編(TODO: リンク作る)で行います。
   著者の経験上イベントストーミングの段階で完璧な集約を定義することは難しいです。そのためこの段階では「集約は大まかにエンティティと同等」と考え、プロジェクトが進行するにつれてその定義を洗練させていくのが良いです。
   :::
7. **外部システム**
   その名の通り外部のシステムです。例えば Twitter や Slcak の API などです。

そしてこれらの要素には次の図のような関係性があります。
@[figma](https://www.figma.com/file/g04nAogGCGgM62IKXHUSLT/Online-bookstore?type=whiteboard&node-id=10-1551&t=ppbGdPusmMcJCkrs-0)
ドメインイベントを中心に捉え、イベント同士に繋がりがある場合に必ず以下の 2 パターンのどちらかを経由し、繋げる必要があります。

- ドメインイベント -> ビュー/リードモデル -> アクター -> コマンド -> 外部システム/集約 -> ドメインイベント
- ドメインイベント -> ポリシー -> コマンド -> 外部システム/集約 -> ドメインイベント

複数の関係者やシステムがどう絡み合っているのかを理解するため、参加者全員で情報を出し合い、誰がどんな行動を取り、それによってどんな出来事が起こるのかを一緒に書き出していきます。このやり取りを繰り返すことで、全体の流れが見えやすくなり、より明確に理解できるようになります。

## 進め方

フローを細分化して説明していきます。

1. **参加者の選定**

- ドメインエキスパート
- ソフトウェア開発者
- プロダクトオーナーやプロジェクトマネージャー
- UX/UI デザイナーなど、関連するステークホルダー
  :::message
  著者の経験上、サービスに UI が必要となる場合、UX/UI デザイナーも同席することをお勧めします。理由は 3 点あります。

  1. **直感的なインターフェイスの議論**
     システムの動作やプロセスを議論する際、それをサポートする UI の要件や挙動に関するディスカッションも必要となることがあります。デザイナーが同席することで、これらの議論がより具体的かつ効果的に進行します。

  2. **プロトタイピングの迅速なフィードバック**
     イベントストーミングの結果をもとにプロトタイプやモックアップが作成される場合、デザイナーはその場で迅速かつ適切なフィードバックを提供することができます。

  3. **UI/UX の向上**
     システムやサービスの成功は、技術的な実装だけでなく、最終的な UI/UX にも大きく依存します。デザイナーが初期段階から関与することで、最終的な製品の品質とユーザーサティスファクションを向上させることができます。
     :::

1. **ツールの選定**

- ホワイトボード(オフライン)
- miro、figjam などのオンラインコラボレーションツール
  今回は[figjam](https://www.figma.com/ja/figjam/)を利用していきます。

3. **ドメインイベントの洗い出し**
   主要なドメインで起きるドメインイベントを参加者全員で洗い出します。恐れることはありません、思いつく限り出しましょう。この時に何となくの時系列で配置しておくと 4 の手間が軽減します。
4. **ドメインイベント同士を時系列で繋げる**
   ドメインイベント同士に繋がりがある場合、ドメインイベントと同士を時系列の流れに合わせて矢印で繋ぎます。
5. **ドメインイベント同士のギャップを埋める**
   前の項目で説明したルールに則ってドメインイベント間のギャップを埋めていきます。
   a. **疑問、懸念事項、不確実要素をメモする**
   イベントストーミングを通して発生した疑問、懸念事項、不確実要素などをホットスポットとしてログを残します。この作業はどのタイミングで行っても大丈夫です。
6. **集約を特定する**
   **コマンド**の目的語に当たるものが集約である可能性が高いです。例えば：「注文を承認する」がコマンドの場合「注文」が集約になります。
7. **境界づけられたコンテキストの定義、コアドメイン、サブドメインを特定する**
   同一名称の集約が存在した場合それぞれを比較し、言葉が持つ意味や関連情報が異なる場合、境界づけられたコンテキストとなります。適当に線を引き区分けしましょう。その後、各境界でコアドメインなのかサブドメインなのかを特定します。

:::message
上記の順番を完璧に守る必要はありません。フローが進むにつれて新しいドメインイベントの発見や、考慮漏れが必ず発生するのでその都度書き加えるなど柔軟に対応しましょう。
:::

# オンライン書店ドメインを例にやってみる

今まで例として扱ってきたオンライン書店ドメインで実際にイベントストーミングを行なっていきましょう。

:::message alert
内容はオンライン書店のビジネスモデルや要件に応じて異なります。
ここではシンプルにするため、「認証」、「発送」など細かな知識を一部省略しています。
また、著者はオンライン書店のドメインエキスパートではございません。
書店や EC 領域の理解に間違いがある可能性がございます。予めご了承ください。
:::

1. **参加者の選定**
   今回は著者一名で行います。
2. **ツールの選定**
   今回は[figjam](https://www.figma.com/ja/figjam/)を利用していきます。
3. **ドメインイベントの洗い出し**
   @[figma](https://www.figma.com/file/g04nAogGCGgM62IKXHUSLT/Online-bookstore?type=whiteboard&node-id=1-1547&t=ppbGdPusmMcJCkrs-0)
4. **ドメインイベント同士を時系列で繋げる**
   @[figma](https://www.figma.com/file/g04nAogGCGgM62IKXHUSLT/Online-bookstore?type=whiteboard&node-id=332-553&t=P5SgzhzwPW6aWrpT-0)
5. **ドメインイベント同士のギャップを埋める**
   ここではプロセス中に考慮漏れに気づき、ドメインイベントを追加しています。
   @[figma](https://www.figma.com/file/g04nAogGCGgM62IKXHUSLT/Online-bookstore?type=whiteboard&node-id=486-862&t=3OOKVvzzGCmuQPXD-0)
   a. **疑問、懸念事項、不確実要素をメモする**
   @[figma](https://www.figma.com/file/g04nAogGCGgM62IKXHUSLT/Online-bookstore?type=whiteboard&node-id=729-1163&t=vWwcw54QwFOojvjC-0)
6. **集約を特定する**
   @[figma](https://www.figma.com/file/g04nAogGCGgM62IKXHUSLT/Online-bookstore?type=whiteboard&node-id=729-1434&t=vWwcw54QwFOojvjC-0)
7. **境界づけられたコンテキストの定義、コアドメイン、サブドメインを特定する**
   @[figma](https://www.figma.com/file/g04nAogGCGgM62IKXHUSLT/Online-bookstore?type=whiteboard&node-id=843-1791&t=hvtQJVFBGW90SwuN-0)

以上でイベントストーミングは終了です。
イベントストーミングを通じて作成された図は、ドメインにとって重要なワークフローを視覚的に表現するものです。このプロセスは、関係者がビジネスの要件、制約を理解し、システムの振る舞いや相互作用を明確に把握するのに非常に役立ちます。しかしながら、ビジネスや市場のニーズは時間とともに変化します。したがって、イベントストーミングが一度完了したとしても、その成果物は静的なものではなく、進化し続けるドメインの動きを反映するために、定期的なレビューと更新が必要となります。

# まとめ

- イベントストーミングは、**複雑なビジネスプロセスやドメインの知識を共有、可視化、そして理解するための協同作業ベースのモデリング手法**
- 変化に対応するため定期的更新が必要

本章では戦略的設計における「コアドメイン、サブドメインの特定」、「境界づけられたコンテキストの定義」、「エンティティの特定(ビジネス要件の確認、エンティティの識別)」、「ビジネスルールの把握」を行いました。
以降「在庫管理コンテキスト(サブドメイン)」を対象として扱い、DDD を探究していきます。次章では戦略的設計における「エンティティの特定(属性の識別、エンティティ間の関連の定義)」を、**PlantUML**を利用し行います。
